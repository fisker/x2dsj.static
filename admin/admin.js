var input=function(){var a=window.location.search;a=a.slice(1);a=a.split("&");for(var c={},b=0;b<a.length;b++){var d=a[b].split("=");c[d[0].toLowerCase()]=a[b].slice(d[0].length+1)}return c}(),playlistUrl="",playlistArr=[],chineseI=["\u96f6","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d","\u4e03","\u516b","\u4e5d","\u5341","\u5341\u4e00","\u5341\u4e8c","\u5341\u4e09","\u5341\u56db","\u5341\u4e94","\u5341\u516d","\u5341\u4e03","\u5341\u516b","\u5341\u4e5d","\u4e8c\u5341"],englishI="0ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
function secToTime(a){var c="";a=parseInt(a,10);if(a==0)return"\u672a\u77e5\u65f6\u957f";if(a>=86400){var b=parseInt(a/24/60/60,10);c+=b+"\u5929";a-=b*86400}a>=3600&&(b=parseInt(a/60/60,10),c+=b+"\u5c0f\u65f6",a-=b*3600);a>=60&&(b=parseInt(a/60,10),c+=b+"\u5206",a-=b*60);a>=0&&(a=parseInt(a,10),c+=a+"");if(c!="")return c;return"\u672a\u77e5\u65f6\u957f"}function goAutoPut(){var a={tv:input.tv,u:$.trim($("#u").val())};window.open("autoput.php?"+$.param(a))}
var JSON={chars:{"":"\\b","\t":"\\t","\n":"\\n","":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},type:function(a){if(typeof a==="undefined")return"undefined";if(a===null)return"null";return Object.prototype.toString.call(a).match(/\s(.+)]$/)[1].toLowerCase()},replaceChars:function(a){this.chars[a]=this.chars[a]||"\\u00"+Math.floor(a.charCodeAt()/16).toString(16)+(a.charCodeAt()%16).toString(16);return this.chars[a]},encode:$.parseJSON,decode:function(a,c){if(this.type(a)!="string"||!a.length)return null;
if(c&&!/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/.test(a.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,"")))return null;try{return eval("("+a+")")}catch(b){return null}}};function enableSubmit(a){$("#submit").attr("disabled",a?!a.checked:!1);$("#submit").attr("disabled")||$("#submit").focus()}function addPart(){var a=$("#ep_name")[0].value;a.indexOf("(")==-1?alert("\u597d\u50cf\u6ca1\u5206\u96c6"):(a=a.substring(a.indexOf("(")+1),a=a.substring(0,a.length-1),$("#ep_filename").val("P"+a))}
function setStatus(){var a=$("#status")[0].value;a.length<1?alert("\u6ca1\u5199\u72b6\u6001"):$.get("api.php?method=setstatus&tv="+tv_id+"&tvfilename="+tv_filename+"&sta="+encodeURI(a)+"&_="+ +new Date,function(a){alert(a)})}
function fillsep(a){var c=$("#ep_name").val(),b="",d="",e=$("#q_session").val(),f=$("#q_episode").val(),g=$("#q_part").val(),l=!!$("#q_sub").attr("checked"),h=$("#q_lang").val();e&&(b+="\u7b2c"+e+"\u5b63",d+="S"+e);if(f.indexOf("-")!=-1){e=parseInt(f.split("-")[0]);for(var i=parseInt(f.split("-")[f.split("-").length-1]),k=[],j=e;j<=i;j++)k.push(j);b+=" \u7b2c"+e+"-"+i+"\u96c6";d+="E"+k.join("E");c&&(c.indexOf(e)==-1||c.indexOf(i)==-1)&&alert("\u5267\u96c6\u540d\u79f0\u91cc\u9762\u6ca1"+f+",\u5c0f\u5fc3\u5f04\u9519\u54e6")}else f&&(b+=" \u7b2c"+f+"\u96c6",d+="E"+f,c&&c.indexOf(f)==-1&&
alert("\u5267\u96c6\u540d\u79f0\u91cc\u9762\u6ca1"+f+",\u5c0f\u5fc3\u5f04\u9519\u54e6"));g&&(b+=""+englishI[g]+"",d+="P"+g,c&&c.indexOf(g)==-1&&c.indexOf(englishI[g])==-1&&alert("\u5267\u96c6\u540d\u79f0\u91cc\u9762\u6ca1\u7b2c"+englishI[g]+"\u90e8\u5206,\u5c0f\u5fc3\u5f04\u9519\u54e6"));l&&(b+=" \u65e0\u5b57\u5e55");b=$.trim(b);ep_name&&b!=ep_name&&$("#ep_newdate").attr("checked","checked");b==ep_name&&$("#ep_newdate").attr("checked",!1);d=d.replace(/\-/g,"E");h&&(b=h+" "+b,h=="\u56fd\u8bed"&&(d="CN-"+d));a||$("#ep_name").val(b);$("#ep_filename").val(d);enableSubmit()}var OS={};
OS.get=function(){var a=$("#othersite-url")[0].value;a?($("othersite-loading").innerHTML="\u6b63\u5728\u52a0\u8f7d...",$.get("getJson.php?act=tv&u="+escape(a),this.handler)):alert("\u5199\u4e0a\u5730\u5740\uff0c\u5148")};OS.handler=function(a){if(a=JSON.decode(a)){for(var c in a)$("#"+c).val(a[c]);this.pic();$("#othersite-loading").html("")}else $("#othersite-loading").html(""),alert("\u65e0\u6cd5\u7406\u89e3\u7684\u670d\u52a1\u5668\u8fd4\u56de\u4fe1\u606f")};
OS.pic=function(){var a=$("#tv_image")[0].value;a.indexOf("://")==-1&&(a="../"+a);a.length>3&&$("#pic").html("<img src='"+a+"' />");$("#upload").hide();$("#pic").show()};OS.uploadImage=function(a){$("#pic").hide();$("#upload").show().html(['<div class=\'float-list\'><iframe height="350" src="',a=="xroom"?STATIC_SERVER+"admin/file/uploadXroom.html":"../xxxxx_upload.php",'" width="250"></iframe></div>'].join(""))};var CAT={};
CAT.get=function(a){$("#selectCAT").html("\u6b63\u5728\u52a0\u8f7d...");a=="del"?$.get("api.php?method=getcat",this.delhandeler):$.get("api.php?method=getcat",this.handeler)};CAT.go=function(a){window.location.href="?cat="+a};CAT.del=function(){alert("\u529f\u80fd\u5236\u4f5c\u4e2d")};CAT.delAll=function(){alert("\u529f\u80fd\u5236\u4f5c\u4e2d")};
CAT.handeler=function(a){a=JSON.decode(a)||[];if(a.length){var c="<select onchange='javascript:CAT.go(this.value)'>";c+="<option value='0'>-------"+a.length+"\u4e2a\u5206\u7c7b-------</option>";for(var b=0;b<a.length;b++)c+="<option value='"+a[b].cat_id+"'>"+a[b].cat_name+"</option>";c+="</select>";$("#selectCAT").html(c)}else $("#selectCAT").html(""),alert("\u6ca1\u4efb\u4f55\u5206\u7c7b")};
CAT.delhandeler=function(a){a=JSON.decode(a)||[];if(a.length){for(var c="<div class='float-list'>",b=0;b<a.length;b++)c+="<input type='checkbox' name='willdel' value='"+a[b].cat_id+"' title='"+a[b].cat_name+"'/>"+a[b].cat_name+"<br />";c+='<input type="button" class="button" value="\u5220\u9664\u9009\u4e2d\u7684\u5206\u7c7b" onclick="javascript:CAT.del();" />';c+="</div>";$("#selectCAT").html(c)}else $("#selectCAT").html(""),alert("\u6ca1\u627e\u5230\u5267\u96c6")};var VIDEO={};
VIDEO.preview=function(a){for(var c in a)a[c]&&$("#"+c).val(a[c]);$("#testImg").html("<img src='"+a.ep_image+"' />");a=getSEP(a.ep_name);c=a.s;var b=a.e,d=a.p;c&&$("#q_session").val(c);b&&$("#q_episode").val(b);d&&$("#q_part").val(d);a.nosub&&$("#q_sub").attr("checked","checked");a.lang&&$("#q_lang").val(a.lang)};var EP={};EP.sort=function(){window.open("ep_sort.php?tv="+input.tv)};
EP.get=function(a){$("#selectEP").html("\u6b63\u5728\u52a0\u8f7d...");a=="del"?$.getScript("api.php?method=getep&tv="+tv_filename,this.delhandeler):$.getScript("api.php?method=getep&tv="+tv_filename,this.handeler)};
EP.del=function(){for(var a=input.tv,c=$("#selectEP input"),b=[],d=[],e=0;e<c.length;e++)c[e].checked&&c[e].name=="willdel"&&c[e].type=="checkbox"&&(b.push(c[e].value),d.push(c[e].title));b.length<1?alert("\u672a\u9009\u62e9\u4efb\u4f55\u5267\u96c6"):confirm("\u786e\u5b9a\u8981\u5220\u9664\u4ee5\u4e0b\u5267\u96c6\uff1f\n"+d.join("\n")+"")&&$.get("api.php?method=delep&tv="+a+"&id="+b.join(","),function(a){alert(a);EP.get("del")})};EP.delAll=function(){confirm("\u786e\u5b9a\u8981\u5220\u9664\u5168\u90e8\uff1f")&&$.get("api.php?method=delep&tv="+input.tv+"&id=all",function(a){alert(a)})};
EP.handeler=function(a){a=JSON.decode(a)||[];if(a.length){var c="<select onchange='javascript:EP.go(this.value)'>";c+="<option value='0'>-----"+a.length+"\u4e2a\u89c6\u9891-------</option>";for(var b=0;b<a.length;b++)c+="<option value='"+a[b].id+"'>"+a[b].name+"</option>";c+="</select>";$("#selectEP").html(c)}else $("#selectEP")[0].innerHTML="",alert("\u6ca1\u627e\u5230\u5267\u96c6")};
EP.delhandeler=function(a){a=JSON.decode(a)||[];if(!a||a.length<1)$("#selectEP")[0].innerHTML="",alert("\u6ca1\u627e\u5230\u5267\u96c6");else{for(var c="<div class='float-list'>",b=0;b<a.length;b++)c+="<input type='checkbox' name='willdel' value='"+a[b].ep_id+"' title='"+a[b].ep_name+"'/>"+a[b].ep_name+"<br />";c+='<input type="button" class="button" value="\u5220\u9664\u9009\u4e2d\u7684\u5267\u96c6" onclick="javascript:EP.del();" />';c+="</div>";$("#selectEP").html(c)}};
EP.go=function(a){if(!(input.tv==0||a==0))window.location.href="?tv="+input.tv+"&ep="+a};var TV={};
TV.get=function(){var a=$.trim($("#q").val());a.indexOf("://")!=-1?($("#u").val(a),PLAYLIST.get()):(a=a.replace(/\u7b2c(\d+)[\u90e8|\u96c6|\u5b63|\u8bdd]/g," ").replace(/\u7b2c[\u4e00|\u4e8c|\u4e09|\u56db|\u4e94|\u516d|\u4e03|\u516b|\u4e5d|\u5341]{1,}[\u90e8|\u96c6|\u5b63]/g," ").replace(/\u3010|\u3011/g," ").replace(/\u300a|\u300b|\u300c|\u300d/g," ").replace(/\(|\)/g," ").replace(/\uff08|\uff09/g," ").replace(/\[|\]/g," ").replace(/-|\u2014/g," ").replace(/_/g," ").replace(/\./g," "),a=function(a){var b=$.trim($.trim(a).split(" ").shift());if(b.match(/^\d+$/))return a;var d=b.replace(/(\D+)\d+/g,"$1 ");if(d.match(/^\d+\D+$/))return d;
b=b.replace(/\d+/g," ");if(b.length<3)return a;return b}(a),(a=$.trim($.trim(a).split(" ").shift()))?($("#selectTV").html("\u6b63\u5728\u52a0\u8f7d..."),$.getJSON("api.php?method=gettv&q="+encodeURIComponent(a)+"&callback=?",function(a){$("#selectTV").html("");a=a?a:[];if(a.length){for(var b=['<select onchange="javascript:TV.go(this.value)">','<option value="0">-----'+a.length+"\u4e2a\u7535\u89c6--------</option>"],d=0;d<a.length;d++)b.push('<option value="'+a[d].id+'">['+a[d].status+"]"+a[d].name+"</option>");b.push("</select>");
$("#selectTV").html(b.join(""))}else alert("\u6ca1\u627e\u5230\u7535\u89c6\u5267")})):alert("\u7535\u89c6\u5267\u540d\u79f0\u6ca1\u5199"))};TV.del=function(){if(!tv_filename||!tv_id)alert("\u5148\u9009\u62e9\u4f60\u8981\u5220\u9664\u7684\u7535\u89c6\u5267");else if(confirm("\u786e\u5b9a\u8981\u5220\u9664["+$("#tv_name").val()+"]\uff1f"))$.get("api.php?method=deltv&tvfilename="+tv_filename+"&tv="+tv_id,function(a){alert(a)}),window.location.href="?"};TV.showEp=function(){$("#input-ep").toggle()};TV.go=function(a){if(a!=0)window.location.href="?tv="+a};var PLAYLIST={};
PLAYLIST.focus=function(){var a=$("playlist-url").value;if(a==input.u||a=="\u4f18\u9177\u6216\u571f\u8c46\u6216KU6\u64ad\u653e\u5217\u8868")$("playlist-url").value=""};PLAYLIST.blur=function(){var a=$("#playlist-url")[0].value,c=input.u?input.u:"\u4f18\u9177\u6216\u571f\u8c46\u6216KU6\u64ad\u653e\u5217\u8868";a.length<1&&$("#playlist-url").val(c)};
PLAYLIST.get=function(a){var c=$.trim($("#u").val());c?c.indexOf("://")==-1?($("#q").val(c),TV.get()):($("#selectVideo").html("\u6b63\u5728\u52a0\u8f7d..."),$.getJSON("getJson.php?u="+encodeURIComponent(c)+"&callback=?",function(b){$("#selectVideo").html("");window.playlistArr=b?b:[];if(playlistArr.length){$("#selectVideo").html('<select id="playlist-selector" onchange="javascript:PLAYLIST.select(this.value)"><option value="-1">---- 0 ----</option></select>');b=$("#playlist-selector");var c=99999,e=0;html=['<option value="-1">---- '+
playlistArr.length+" ----</option>"];for(var f=0;f<playlistArr.length;f++){if(playlistArr[f].ep_duration>e)e=playlistArr[f].ep_duration;if(playlistArr[f].ep_duration<c)c=playlistArr[f].ep_duration;html.push('<option value="'+f+'">'+playlistArr[f].ep_name+" ["+secToTime(playlistArr[f].ep_duration)+"]</option>")}b.html(html.join(""));a!==void 0?PLAYLIST.select(parseInt(a,10)):playlistArr.length==1&&PLAYLIST.select(0)}})):alert("\u5730\u5740\u6ca1\u5199")};
PLAYLIST.jump=function(a){if(!(input.u==a||input.u==encodeURI(a))){var c=[],b;for(b in input)b!="u"&&c.push(b+"="+input[b]);c.push("u="+encodeURI(a));window.location.href="?"+c.join("&")}};PLAYLIST.select=function(a){if(!playlistArr.length)return alert("...zzzZZZ"),!1;if(a<0)return!1;a=parseInt(a);VIDEO.preview(playlistArr[a]);setTimeout(function(){$("#playlist-selector").val(a)},0);!$("#ep_filename").val()&&input.u&&fillsep(!0)};
function toInt(a){if(!a)return 0;if(a=="\u4e0a")return 1;if(a=="\u4e2d")return 2;if(a=="\u4e0b")return 2;a=a.replace(/^\u5341/,"\u4e00\u5341").replace(/\u5341$/,"0").replace(/\u767e$/,"00").replace(/\u5343$/,"000").replace(/\u4e07$/,"000").replace(/[\u5341|\u767e|\u5343|\u4e07]/,"").replace(/ix/ig,"9").replace(/viii/ig,"8").replace(/vii/ig,"7").replace(/vi/ig,"6").replace(/iv/ig,"4").replace(/iii/ig,"3").replace(/ii/ig,"2");a+="";for(var c=["\uff10\u2460\u2461\u2462\u2463\u2464\u2465\u2466\u2467\u2468\u2469","\uff10\uff11\uff12\uff13\uff14\uff15\uff16\uff17\uff18\uff19","\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d","abcdefghijklmnopqrstuvwxyz","\u2160\u2161\u2162\u2163\u2164\u2165\u2166\u2167\u2168\u2169\u216a\u216b"],b=0;b<c.length;b++)for(var d=c[b].split(""),
e=0;e<d.length;e++)a=a.replace(RegExp(d[e],"g"),e);return parseInt(a,10)}
function getSEP(a){a=a.replace(/\d{2,4}\u6700\u65b0/g,"").replace(/(19|20)\d{2,2}/g,"").replace(/\d{6,}/g,"").replace(/\d{2,2}\.\d{2,2}\.\d{2,2}/g,"").replace(/\d{4,}/g,"").replace(/DVD/g,"").replace(/TV/g,"").replace(/\u5168\u96c6/g,"").replace(/\u2160/g,"\u7b2c1\u5b63").replace(/\u2161/g,"\u7b2c2\u5b63").replace(/\u2162/g,"\u7b2c3\u5b63").replace(/\u2163/g,"\u7b2c4\u5b63").replace(/iv/ig,"\u7b2c4\u5b63").replace(/iii/ig,"\u7b2c3\u5b63").replace(/ii/ig,"\u7b2c2\u5b63").replace(/\u90e8/g,"\u5b63").replace(/\u8bdd/g,"\u96c6").replace(/\u56de/g,"\u96c6").replace(/(^\s*)|(\s*$)/g,"");var c=function(){if(a.match(/S(\d+)E(\d+)/ig))return/S(\d+)E(\d+)/ig.exec(a)[1];
if(a.match(/\u7b2c(.*?)\u5b63/ig))return/\u7b2c(.*?)\u5b63/ig.exec(a)[1];if(a.match(/Season(\d+)/ig))return/Season(\d+)/ig.exec(a)[1];if(a.match(/(\d+)\s/ig))return/(\d+)\s/ig.exec(a)[1];return 0}(),b=function(){a=a.replace(RegExp("\u7b2c"+c+"\u5b63"),"");if(a.match(/S(\d+)E(\d+)/ig))return/S(\d+)E(\d+)/ig.exec(a)[2];if(a.match(/\u7b2c(.*?)\u96c6/ig))return/\u7b2c(.*?)\u96c6/ig.exec(a)[1];if(a.match(/Episode(\d+)/ig))return/Episode(\d+)/ig.exec(a)[1];if(a.match(/(\d+)\u96c6/ig))return/(\d+)\u96c6/ig.exec(a)[1];if(a.match(/Ep(\d+)/ig))return/Ep(\d+)/ig.exec(a)[1];
if(a.match(/(\d+)(\.|\-)/ig))return/(\d+)(\.|\-)/ig.exec(a)[1];if(a.match(/(\d+)$/ig))return/(\d+)$/ig.exec(a)[1];if(a.match(/\s(\d+)/ig))return/\s(\d+)/ig.exec(a)[1];if(a.match(/(\d+)/ig))return/(\d+)/ig.exec(a)[1]}(),d=function(){if(a.match(/(\u4e0a|\u4e2d|\u4e0b)$/g))return/(\u4e0a|\u4e2d|\u4e0b)$/g.exec(a)[1];if(a.match(/([a-z])$/ig))return/([a-z])$/ig.exec(a)[1];if(a.match(/\u96c6([a-z]|\d+)/ig))return/\u96c6([a-z]|\d+)/ig.exec(a)[1];return 0}(),e={s:0,e:0,p:0,f:""};if((c=toInt(c))&&c<25)e.s=c,e.f+="S"+c;if(b.indexOf("-")!=-1){d=b.split("-");
b=toInt(d[0]);d=toInt(d[1]);for(e.e=b+"-"+d;b<=d;b++)e.f+="E"+b;d=0}else b=toInt(b),e.e=b,e.f+="E"+b;if((d=toInt(d))&&d<10)e.p=d,d="abcdefghijklmnopqrstuvwxyz".split("")[d-1],e.f+="P"+d;if(a.indexOf("\u65e0\u5b57")!==-1)e.nosub=!0;if(a.indexOf("\u7ca4\u8bed")!==-1)e.lang="\u7ca4\u8bed";if(a.indexOf("\u56fd\u8bed")!==-1)e.lang="\u56fd\u8bed";return e}
function selectPlayList(a){if(!youku)return alert("\u7b49\u4f1a\u518d\u70b9"),!1;if(a<0)return alert("\u8bf7\u9009\u62e9\u5267\u96c6"),!1;a=parseInt(a,10);var c=youku[a],b;for(b in c)try{$(b).value=c[b]}catch(d){alert(b)}$("testImg").innerHTML="<img src='"+c.ep_image+"' />";if(c.ep_name.indexOf("\u7b2c\u4e00\u5b63")>-1)$("q_session").value=1;$("q_ji").value=parseInt(a+offset,10)+1;a+1==youku.length&&alert("\u4e13\u8f91\u5b8c");$("youku_pl_sel").value=a;return!0}function delCache(){$.get("api.php?method=delcache",function(a){alert(a)})}
function checkActor(a){var c=$(a).val();if(c){var b=c.replace(/\u3000|\u3001|\/|\uff0c|\,|\|/g," ");b=$.trim(b);b=b.replace(/\s+/g," ");for(var d=b.split(" "),e=0;e<d.length;e++)if(d[e].length<2){alert("\u6f14\u5458\u4e2d\u4e0d\u5e94\u8be5\u5305\u542b\u53ea\u6709\u4e00\u4e2a\u5b57\u7684\u540d\u5b57\u3002");$(a).val(b).select();return}b!=c&&$(a).val(b)}}
function doEP(){var a=$("#doEP").val(),c=$("#ep_name"),b=$("#ep_filename"),d=c.val();switch(a){case "\u5927\u7ed3\u5c40":case "\u672c\u5b63\u5b8c":d=d.replace("("+a+")","")+"("+a+")";break;case "\u9884\u544a\u7247":case "\u65e0\u5b57\u5e55":d=d.replace(" "+a,"")+" "+a;break;case "\u7ca4\u8bed":d="\u7ca4\u8bed "+d.replace("\u7ca4\u8bed ","").replace("\u56fd\u8bed ","");b.val(b.val().replace("CN-",""));break;case "\u56fd\u8bed":d="\u56fd\u8bed "+d.replace("\u7ca4\u8bed ","").replace("\u56fd\u8bed ","");b.val("CN-"+b.val().replace("CN-",""));break;case "\u7b2cX\u90e8":d=d.replace("\u5b63","\u90e8")}d=$.trim(d).replace(/\s+/," ",d);d!=a&&c.val(d);$($("#doEP option")[0]).attr("selected",
"selected")}
$(document).ready(function(){function a(){var a=$.trim($("#ep_name").val());a&&ep_name&&$("#ep_newdate").attr("checked",a==ep_name?!1:"checked")}$("*[readonly]").addClass("readonly");epOP="\u5927\u7ed3\u5c40,\u56fd\u8bed,\u7ca4\u8bed,\u672c\u5b63\u5b8c,\u9884\u544a\u7247,\u65e0\u5b57\u5e55,\u7b2cX\u90e8".split(",");for(var c=0;c<epOP.length;c++)$("#doEP").append($("<option>"+epOP[c]+"</option>"));$("#doEP").change(doEP);$("#doEP option").click(doEP);$("input[type=text]").addClass("text").focus(function(){$(this).addClass("focus")}).blur(function(){$(this).removeClass("focus")});$("input[type=text][readonly!=readonly]").dblclick(function(){$(this).val("")});
$("#ep_name").change(a).keyup(a)});
